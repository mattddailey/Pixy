services:
  redis:
    image: redis:bullseye
  celery:
    build:
      dockerfile: python.Dockerfile
    privileged: true
    environment:
      BASE_URL: ${BASE_URL}
      CELERY_BROKER: redis://redis:6379/0
      CELERY_RESULT_BACKEND: redis://redis:6379/0
      SPOTIFY_CLIENT_ID: ${SPOTIFY_CLIENT_ID}
      SPOTIFY_CLIENT_SECRET: ${SPOTIFY_CLIENT_SECRET}
    volumes:
    - ./backend:/backend
    command: celery -A app.celery worker --loglevel=info
    depends_on:
      - redis
  flask:
    build:
      dockerfile: python.Dockerfile
    environment:
      BASE_URL: ${BASE_URL}
      FLASK_APP: app.py
      FLASK_ENV: development
      FLASK_DEBUG: true
      SPOTIFY_CLIENT_ID: ${SPOTIFY_CLIENT_ID}
      SPOTIFY_CLIENT_SECRET: ${SPOTIFY_CLIENT_SECRET}
    volumes:
    - ./backend:/backend
    command: flask run -h 0.0.0.0
    ports: 
      - 5000:5000
    depends_on:
      - celery
  react:
    build:
      dockerfile: react.Dockerfile
    environment:
      REACT_APP_BASE_URL: ${BASE_URL}
    volumes:
    - ./frontend:/frontend
    command: npm start
    ports: 
    - 3000:3000
    
